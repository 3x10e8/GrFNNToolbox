%% rStarCoupled11
%  [r1Star, r2Star, psiStar, stability, stabType] = rStarCoupled11(alpha, beta1, beta2, epsilon, coupling strength, Omega, All)
%
%  Finds steady-state amplitudes (r1*, r2*) and relative phase (psi*) along
%  with their stability and stability type for two canonical oscillators
%  connected by fixed 1:1 coupling.
%
%  Input arguments:
%  alpha, beta1, beta2, epsilon
%                       Oscillator parameters
%  coupling strength    Coupling amplitude
%  Omega                Natural frequency difference (i.e. the first 
%                       oscillator's natural frequency minus the second
%                       oscilltor's frequency) in radian
%
%  Optional input:
%  All                  Set it to 1 (or any nonzero value) to get both 
%                       stable and unstable fixed points. (Default is 0,
%                       i.e., only stable fixed points are output.)
%
%  Output:
%  r1Star               Steady-state amplitude(s) of the first oscillator
%  r2Star               Steady-state amplitude(s) of the second oscillator
%  psiStar              Steady-state relative phase(s) (i.e. first
%                       oscillator phase minus second oscillator phase)
%  stability            Stability of steady state(s)
%                       (1 = stable, 0 = unstable)
%  stabType             Stability type of steady state(s)
%                       (4 = stable node, 3 = stable spiral,
%                       2 = unstable node, 1 = unstable spiral,
%                       0 = saddle point)
%

%% Equation
% $$\frac{dz_1}{dt} = z_1\left(\alpha + \textrm{i}\omega_1 +
% \beta_1 |z_1|^2 + \frac{\epsilon\beta_2|z_1|^4}
% {1-\epsilon |z_1|^2}\right) + cz_2$$
%
% $$\frac{dz_2}{dt} = z_2\left(\alpha + \textrm{i}\omega_2 +
% \beta_1 |z_2|^2 + \frac{\epsilon\beta_2|z_2|^4}
% {1-\epsilon |z_2|^2}\right) + cz_1$$
%
% where $z_i = r_ie^{\textrm{i}\phi_i}, \psi = \phi_1 - \phi_2,$
% and $\Omega = \omega_1 - \omega_2$

%%
function [r1Star, r2Star, psiStar, stability, stabType] = ...
  rStarCoupled11(a, b1, b2, e, c, W, All)

%% Check input arguments
if nargin < 7
  All = 0; % default: only stable points
end
if b2 == 0 && e ~= 0
  e = 0;
end

%% Find symmetric steady-state amplitudes (r1 = r2)
r1 = []; r2 = [];
r = sqrt(roots([ (b1-b2)^2*e^2,...
                  -2*(b1-b2)*(b1-a*e)*e,...
                  b1^2-4*a*b1*e+(2*a*b2+e*(a^2-c^2+W^2/4))*e,...
                  2*a*b1-2*a^2*e+2*c^2*e-e*W^2/2,...
                  a^2-c^2+W^2/4]));
r = r(find(abs(imag(r)) < eps('single'))); % take only real roots
r = real(r);
r = r(find(r ~= 0));
r = unique(r); % remove multiple roots
if b2
  r = r(find(r < 1/sqrt(e))); % take r's below the asymptote
end
r1 = r; r2 = r;

%% Find asymmetric solutions (r1 ~= r2)
rr1 = sqrt(rSquaredAssym(a,b1,b2,e,c,W));
rr1 = rr1(find(abs(imag(rr1)) < eps('single'))); % take only real roots
rr1 = real(rr1);
if b2
  rr1 = rr1(find(rr1 < 1/sqrt(e))); % take r's below the asymptote
end
rr1 = unique(rr1); % remove multiple roots
rr1a = rr1; rr1b = rr1;
rr2a = sqrt(((1-e*power(rr1,2)).*(e*(a-b2*power(rr1,2))+b1*...
  (-1+e*power(rr1,2))) - sqrt(-4*(b1-b2)*e*(-1+e*power(rr1,2)).*...
  (a+b1*power(rr1,2)-a*e.*power(rr1,2)+(-b1+b2)*e*power(rr1,4))+...
  power(-1+e*power(rr1,2),2).*power(e*(a-b2*power(rr1,2))+...
  b1*(-1+e*power(rr1,2)),2)))./(2.*(b1-b2)*e*(-1+e*power(rr1,2))));
rr2b = sqrt(((1-e*power(rr1,2)).*(e*(a-b2*power(rr1,2))+b1*...
  (-1+e*power(rr1,2))) + sqrt(-4*(b1-b2)*e*(-1+e*power(rr1,2)).*...
  (a+b1*power(rr1,2)-a*e.*power(rr1,2)+(-b1+b2)*e*power(rr1,4))+...
  power(-1+e*power(rr1,2),2).*power(e*(a-b2*power(rr1,2))+...
  b1*(-1+e*power(rr1,2)),2)))./(2.*(b1-b2)*e*(-1+e*power(rr1,2))));
inda = find(abs(imag(rr2a)) < eps('single'));
rr1a = rr1a(inda); rr2a = rr2a(inda);
indb = find(abs(imag(rr2b)) < eps('single'));
rr1b = rr1b(indb); rr2b = rr2b(indb);
r1 = [r1; rr1a; rr1b];
r2 = [r2; rr2a; rr2b];

%% Find corresponding relative phases
signPsi = (W >= 0)*2 - 1;
psi = signPsi*acos(-(a*r1+b1*r1.^3+e*b2*r1.^5./(1-e*r1.^2))./(c*r2));
indpsi = find(abs(imag(psi)) < 10^(-3));
r1 = r1(indpsi); r2 = r2(indpsi); psi = psi(indpsi);
psi = real(psi);

%% Exclude extraneous solutions
dev = W-c*(r1.^2+r2.^2)./(r1.*r2).*sin(psi); % deviation in psi-dot eq
ind = find(abs(dev) < 10^(-3));
r1 = r1(ind); r2 = r2(ind); psi = psi(ind);

%% Calculate stability type using Jacobian matrix
stabType = zeros(size(r1));
for n = 1:length(r1)
  J = JacobianCoupled11(a,b1,b2,e,c,r1(n),r2(n),psi(n));
  ev = eig(J);
  if isreal(ev) && all(ev < 0)
    stabType(n) = 4; % stable node
  elseif all(real(ev) < 0)
    stabType(n) = 3; % stable spiral
  elseif isreal(ev) && all(ev > 0)
    stabType(n) = 2; % unstable node
  elseif all(real(ev) > 0)
    stabType(n) = 1; % unstable spiral
  end % saddle pt otherwise
end
stability = (stabType >= 3); % 1 = stable, 0 = unstable

%% Prepare output
if All % both stable and unstable solutions
  r1Star = r1;
  r2Star = r2;
  psiStar = psi;
else % only stable solutions
  indStab = find(stability);
  r1Star = r1(indStab);
  r2Star = r2(indStab);
  psiStar = psi(indStab);
  stability = stability(indStab);
  stabType = stabType(indStab);
end

%% Find asymmetric steady-state amplitudes (r^2)
function r2 = rSquaredAssym(a,b1,b2,e,c,W)
r2 = roots([-256*power(b1-b2,8)*power(b2,2)*power(e,17)*...
(power(b2,2)-2*a*b2*e+power(e,2)*(power(a,2)+power(W,2))),...
256*power(b1-b2,7)*power(b2,2)*power(e,16)*(8*b1-5*b2-3*a*e)*...
(power(b2,2)-2*a*b2*e+power(e,2)*(power(a,2)+power(W,2))),...
-256*power(b1-b2,6)*power(b2,2)*power(e,15)*...
(10*power(b2,4)+power(b2,2)*power(e,2)*...
(-25*power(a,2)+power(c,2)+6*power(W,2))+...
2*a*b2*power(e,3)*(6*power(a,2)-power(c,2)+9*power(W,2))+...
power(a,2)*power(e,4)*(power(c,2)+3*(power(a,2)+power(W,2)))+...
power(b1,2)*(28*power(b2,2)-54*a*b2*e+...
26*power(e,2)*(power(a,2)+power(W,2)))-...
b1*(35*power(b2,3)-42*a*power(b2,2)*e+...
24*a*power(e,3)*(power(a,2)+power(W,2))+...
b2*power(e,2)*(-17*power(a,2)+29*power(W,2)))),...
256*power(b1-b2,5)*power(b2,2)*power(e,14)*...
(-10*power(b2,5)-35*a*power(b2,4)*e+...
a*power(b2,2)*power(e,3)*...
(2*power(a,2)+12*power(c,2)-35*power(W,2))-...
7*power(b2,3)*power(e,2)*(-9*power(a,2)+power(c,2)-2*power(W,2))-...
power(a,3)*power(e,5)*(power(a,2)+2*power(c,2)+power(W,2))+...
8*power(b1,3)*(7*power(b2,2)-12*a*b2*e+...
5*power(e,2)*(power(a,2)+power(W,2)))-...
b2*power(e,4)*(19*power(a,4)+21*power(a,2)*power(W,2)+...
power(c,2)*(3*power(a,2)+power(W,2)))-...
3*power(b1,2)*(35*power(b2,3)-28*a*power(b2,2)*e+...
26*a*power(e,3)*(power(a,2)+power(W,2))+...
3*b2*power(e,2)*(-11*power(a,2)+5*power(W,2)))+...
b1*(60*power(b2,4)+42*a*power(b2,3)*e+...
2*a*b2*power(e,3)*(33*power(a,2)-9*power(c,2)+55*power(W,2))+...
power(e,4)*(24*power(a,2)*(power(a,2)+power(W,2))+...
power(c,2)*(9*power(a,2)+power(W,2)))+...
power(b2,2)*power(e,2)*...
(9*power(c,2)-8*(24*power(a,2)+power(W,2))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,13)*...
(5*power(b2,6)+70*a*power(b2,5)*e+power(a,4)*power(c,2)*power(e,6)+...
7*power(b2,4)*power(e,2)*...
(-5*power(a,2)+3*power(c,2)-8*power(W,2))-...
a*power(b2,3)*power(e,3)*...
(88*power(a,2)+25*power(c,2)+8*power(W,2))+...
power(b1,4)*(70*power(b2,2)-84*a*b2*e+...
15*power(e,2)*(power(a,2)+power(W,2)))+...
a*b2*power(e,5)*(8*power(a,2)*(power(a,2)+power(W,2))+...
power(c,2)*(13*power(a,2)+power(W,2)))+...
power(b2,2)*power(e,4)*(41*power(a,4)+56*power(a,2)*power(W,2)+...
power(W,4)+power(c,2)*(-10*power(a,2)+7*power(W,2)))+...
power(b1,3)*(-175*power(b2,3)-...
120*a*power(e,3)*(power(a,2)+power(W,2))+...
3*b2*power(e,2)*(97*power(a,2)+25*power(W,2)))-...
b1*(50*power(b2,5)+280*a*power(b2,4)*e+...
7*power(b2,3)*power(e,2)*...
(-47*power(a,2)+8*power(c,2)-30*power(W,2))+...
a*power(b2,2)*power(e,3)*...
(-124*power(a,2)-91*power(c,2)+82*power(W,2))+...
a*power(e,5)*(8*power(a,2)*(power(a,2)+power(W,2))+...
power(c,2)*(17*power(a,2)+power(W,2)))+...
b2*power(e,4)*(119*power(a,4)+135*power(a,2)*power(W,2)+...
2*power(W,4)+3*power(c,2)*(6*power(a,2)+5*power(W,2))))+...
power(b1,2)*(150*power(b2,4)+294*a*power(b2,3)*e+...
4*power(b2,2)*power(e,2)*...
(-150*power(a,2)+9*power(c,2)-61*power(W,2))+...
14*a*b2*power(e,3)*(6*power(a,2)-5*power(c,2)+15*power(W,2))+...
power(e,4)*(78*power(a,4)+79*power(a,2)*power(W,2)+power(W,4)+...
power(c,2)*(34*power(a,2)+8*power(W,2))))),...
256*power(b1-b2,4)*power(b2,2)*power(e,12)*...
(power(b2,6)+63*a*power(b2,5)*e+...
power(a,2)*power(c,2)*(8*power(a,2)+power(c,2))*power(e,6)+...
7*power(b2,4)*power(e,2)*...
(13*power(a,2)+5*power(c,2)-12*power(W,2))-...
7*a*power(b2,3)*power(e,3)*...
(26*power(a,2)+power(c,2)+22*power(W,2))+...
8*power(b1,4)*(7*power(b2,2)-...
6*power(e,2)*(power(a,2)+power(W,2)))+...
a*b2*power(e,5)*(26*power(a,4)-2*power(c,4)+...
27*power(a,2)*power(W,2)+power(W,4)+...
power(c,2)*(29*power(a,2)+8*power(W,2)))-...
power(b1,3)*(119*power(b2,3)+294*a*power(b2,2)*e+...
45*a*power(e,3)*(power(a,2)+power(W,2))-...
6*b2*power(e,2)*(71*power(a,2)+57*power(W,2)))+...
power(b2,2)*power(e,4)*(power(c,4)+...
power(c,2)*(-65*power(a,2)+18*power(W,2))+...
9*(power(a,4)+6*power(a,2)*power(W,2)+power(W,4)))+...
power(b1,2)*(81*power(b2,4)+588*a*power(b2,3)*e+...
14*power(b2,2)*power(e,2)*...
(-33*power(a,2)+6*power(c,2)-43*power(W,2))-...
3*a*b2*power(e,3)*(93*power(a,2)+50*power(c,2)+45*power(W,2))+...
2*power(e,4)*(60*power(a,4)+33*power(a,2)*power(c,2)+...
65*power(a,2)*power(W,2)+13*power(c,2)*power(W,2)+...
5*power(W,4)))-b1*...
(19*power(b2,5)+357*a*power(b2,4)*e+...
7*power(b2,3)*power(e,2)*...
(power(a,2)+16*power(c,2)-56*power(W,2))-...
2*a*power(b2,2)*power(e,3)*...
(253*power(a,2)+64*power(c,2)+167*power(W,2))+...
b2*power(e,4)*(129*power(a,4)+184*power(a,2)*power(W,2)+...
19*power(W,4)-44*power(c,2)*(power(a,2)-power(W,2)))+...
a*power(e,5)*(26*power(a,4)+27*power(a,2)*power(W,2)+...
power(W,4)+power(c,2)*(60*power(a,2)+8*power(W,2))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,11)*...
(28*power(b1,4)*(power(b2,2)+3*a*b2*e-...
3*power(e,2)*(power(a,2)+power(W,2)))+...
power(b1,3)*(-49*power(b2,3)-420*a*power(b2,2)*e+...
144*a*power(e,3)*(power(a,2)+power(W,2))+...
42*b2*power(e,2)*(5*power(a,2)+11*power(W,2)))+...
power(b1,2)*(24*power(b2,4)+546*a*power(b2,3)*e+...
14*power(b2,2)*power(e,2)*...
(15*power(a,2)+9*power(c,2)-50*power(W,2))-...
12*a*b2*power(e,3)*(54*power(a,2)+15*power(c,2)+...
61*power(W,2))+5*power(e,4)*...
(9*power(power(a,2)+power(W,2),2)+...
power(c,2)*(11*power(a,2)+8*power(W,2))))-...
b1*(3*power(b2,5)+238*a*power(b2,4)*e+...
7*power(b2,3)*power(e,2)*...
(75*power(a,2)+20*power(c,2)-56*power(W,2))-...
28*a*power(b2,2)*power(e,3)*...
(22*power(a,2)+power(c,2)+32*power(W,2))+...
3*b2*power(e,4)*(-23*power(a,4)+12*power(a,2)*power(W,2)+...
27*power(W,4)+power(c,2)*(-72*power(a,2)+17*power(W,2)))+...
2*a*power(e,5)*(power(c,2)*(53*power(a,2)+13*power(W,2))+...
5*(4*power(a,4)+5*power(a,2)*power(W,2)+power(W,4))))+...
e*(40*power(a,5)*b2*power(e,4)+...
power(a,4)*(-114*power(b2,2)*power(e,3)+...
26*power(c,2)*power(e,5))+...
power(a,2)*(189*power(b2,4)*e+...
power(c,2)*power(e,5)*(8*power(c,2)+power(W,2))-...
2*power(b2,2)*power(e,3)*(65*power(c,2)+27*power(W,2)))+...
power(a,3)*(-112*power(b2,3)*power(e,2)+...
b2*power(e,4)*(7*power(c,2)+50*power(W,2)))+...
power(b2,2)*e*(8*power(c,4)*power(e,2)-...
70*power(b2,2)*power(W,2)+36*power(e,2)*power(W,4)+...
power(c,2)*(35*power(b2,2)+12*power(e,2)*power(W,2)))+...
a*b2*(28*power(b2,4)+...
7*power(b2,2)*power(e,2)*(9*power(c,2)-44*power(W,2))+...
2*power(e,4)*(-8*power(c,4)+12*power(c,2)*power(W,2)+...
5*power(W,4))))),...
256*power(b1-b2,4)*power(b2,2)*power(e,10)*...
(8*power(b1,4)*(power(b2,2)+12*a*b2*e-...
6*power(e,2)*(power(a,2)+power(W,2)))+...
power(b1,3)*(-11*power(b2,3)-300*a*power(b2,2)*e-...
6*b2*power(e,2)*(31*power(a,2)-53*power(W,2))+...
252*a*power(e,3)*(power(a,2)+power(W,2)))-...
b1*e*(-354*power(a,4)*b2*power(e,3)+15*power(a,5)*power(e,4)+...
10*power(a,3)*(-14*power(b2,2)*power(e,2)+...
power(e,4)*(7*power(c,2)+6*power(W,2)))+...
a*(83*power(b2,4)+98*power(b2,2)*power(e,2)*...
(2*power(c,2)-11*power(W,2))+...
5*power(e,4)*power(W,2)*(8*power(c,2)+9*power(W,2)))+...
power(a,2)*b2*e*(683*power(b2,2)-...
18*power(e,2)*(20*power(c,2)+13*power(W,2)))+...
2*b2*e*(-117*power(b2,2)*power(W,2)+102*power(e,2)*power(W,4)+...
2*power(c,2)*(28*power(b2,2)-9*power(e,2)*power(W,2))))+...
power(b1,2)*(3*power(b2,4)+282*a*power(b2,3)*e+...
2*power(b2,2)*power(e,2)*...
(381*power(a,2)+63*power(c,2)-235*power(W,2))-...
84*a*b2*power(e,3)*(power(c,2)+6*(power(a,2)+2*power(W,2)))-...
3*power(e,4)*(power(c,2)*(11*power(a,2)-5*power(W,2))+...
8*(6*power(a,4)+power(a,2)*power(W,2)-5*power(W,4))))+...
e*(15*power(a,5)*b2*power(e,4)+...
power(a,4)*(-210*power(b2,2)*power(e,3)+...
40*power(c,2)*power(e,5))+...
power(a,2)*(155*power(b2,4)*e+...
2*power(c,2)*power(e,5)*(13*power(c,2)+5*power(W,2))-...
14*power(b2,2)*power(e,3)*(7*power(c,2)+15*power(W,2)))+...
power(a,3)*b2*power(e,2)*...
(112*power(b2,2)+3*power(e,2)*(-29*power(c,2)+20*power(W,2)))+...
power(b2,2)*e*(28*power(c,4)*power(e,2)-...
34*power(b2,2)*power(W,2)+84*power(e,2)*power(W,4)+...
21*power(c,2)*(power(b2,2)-2*power(e,2)*power(W,2)))+...
a*b2*(5*power(b2,4)+...
7*power(b2,2)*power(e,2)*(19*power(c,2)-46*power(W,2))+...
3*power(e,4)*(-18*power(c,4)+7*power(c,2)*power(W,2)+...
15*power(W,4))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,9)*...
(power(b1,4)*(power(b2,2)+54*a*b2*e+...
15*power(e,2)*(power(a,2)+power(W,2)))-...
power(b1,3)*(power(b2,3)+120*a*power(b2,2)*e+...
6*b2*power(e,2)*(61*power(a,2)-15*power(W,2))-...
144*a*power(e,3)*(power(a,2)+power(W,2)))-...
2*power(b1,2)*e*(-36*power(a,3)*b2*power(e,2)+...
126*power(a,4)*power(e,3)+89*power(b2,2)*e*power(W,2)-...
105*power(e,3)*power(W,4)-...
6*power(c,2)*(7*power(b2,2)*e-4*power(e,3)*power(W,2))+...
a*(-39*power(b2,3)-6*b2*power(e,2)*...
(7*power(c,2)-57*power(W,2)))+...
power(a,2)*(-357*power(b2,2)*e+...
3*power(e,3)*(22*power(c,2)+7*power(W,2))))+...
b1*e*(378*power(a,4)*b2*power(e,3)+48*power(a,5)*power(e,4)+...
82*power(b2,3)*e*power(W,2)-336*b2*power(e,3)*power(W,4)+...
power(c,2)*(-56*power(b2,3)*e+210*b2*power(e,3)*power(W,2))+...
power(a,3)*(-464*power(b2,2)*power(e,2)+...
9*power(e,4)*(9*power(c,2)-8*power(W,2)))+...
power(a,2)*(-425*power(b2,3)*e+...
42*b2*power(e,3)*(6*power(c,2)+7*power(W,2)))-...
a*(12*power(b2,4)+10*power(b2,2)*power(e,2)*...
(35*power(c,2)-74*power(W,2))+...
15*power(e,4)*power(W,2)*(power(c,2)+8*power(W,2))))+...
power(e,2)*(8*power(c,4)*power(e,2)*...
(7*power(b2,2)-12*a*b2*e+5*power(a,2)*power(e,2))+...
power(c,2)*(7*power(b2,4)+133*a*power(b2,3)*e+...
14*power(b2,2)*power(e,2)*(4*power(a,2)-9*power(W,2))+...
15*power(a,2)*power(e,4)*(power(a,2)+3*power(W,2))-...
6*a*b2*power(e,3)*(29*power(a,2)+11*power(W,2)))+...
b2*(-126*power(a,4)*b2*power(e,2)-48*power(a,5)*power(e,3)-...
9*b2*power(W,2)*(power(b2,2)-14*power(e,2)*power(W,2))+...
power(a,2)*(62*power(b2,3)-252*b2*power(e,2)*power(W,2))+...
8*power(a,3)*(31*power(b2,2)*e+9*power(e,3)*power(W,2))-...
40*a*(5*power(b2,2)*e*power(W,2)-3*power(e,3)*power(W,4))))),...
256*power(b1-b2,4)*power(b2,2)*power(e,9)*...
(84*power(a,5)*(b1-b2)*power(e,4)-...
6*power(a,4)*power(e,3)*(24*power(b1,2)-13*b1*b2-11*power(b2,2)+...
8*power(c,2)*power(e,2))+...
power(a,3)*power(e,2)*(-45*power(b1,3)+459*power(b1,2)*b2+...
b1*(-601*power(b2,2)+...
18*power(e,2)*(12*power(c,2)-7*power(W,2)))+...
b2*(187*power(b2,2)+126*power(e,2)*(-power(c,2)+power(W,2))))+...
power(a,2)*e*(40*power(b1,4)-259*power(b1,3)*b2+10*power(b2,4)+...
2*power(b2,2)*power(e,2)*(95*power(c,2)-72*power(W,2))+...
15*power(c,2)*power(e,4)*(power(c,2)+8*power(W,2))-...
4*b1*b2*(34*power(b2,2)+...
9*power(e,2)*(2*power(c,2)-power(W,2)))+...
3*power(b1,2)*(115*power(b2,2)+...
4*power(e,2)*(-11*power(c,2)+9*power(W,2))))+...
a*(16*power(b1,4)*b2-5*power(b1,3)*...
(5*power(b2,2)+9*power(e,2)*power(W,2))+...
3*power(b1,2)*b2*(3*power(b2,2)+...
5*power(e,2)*(12*power(c,2)-11*power(W,2)))+...
b2*power(e,2)*(-84*power(c,4)*power(e,2)-...
73*power(b2,2)*power(W,2)+210*power(e,2)*power(W,4)+...
3*power(c,2)*(25*power(b2,2)-84*power(e,2)*power(W,2)))+...
b1*power(e,2)*(283*power(b2,2)*power(W,2)-...
210*power(e,2)*power(W,4)+...
power(c,2)*(-304*power(b2,2)+48*power(e,2)*power(W,2))))+...
e*(70*power(b2,2)*power(c,4)*power(e,2)+...
(b1-b2)*power(W,2)*(40*power(b1,3)+15*power(b1,2)*b2+...
power(b2,3)-126*b2*power(e,2)*power(W,2)-...
14*b1*(power(b2,2)-18*power(e,2)*power(W,2)))+...
power(c,2)*(power(b2,4)-168*power(b2,2)*power(e,2)*power(W,2)+...
12*power(b1,2)*(3*power(b2,2)-7*power(e,2)*power(W,2))-...
16*b1*(power(b2,3)-21*b2*power(e,2)*power(W,2))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,8)*...
(48*power(a,5)*(b1-b2)*power(e,4)+...
3*power(a,4)*power(e,3)*(15*power(b1,2)-68*b1*b2+53*power(b2,2)-...
28*power(c,2)*power(e,2))+...
2*power(a,3)*power(e,2)*(-60*power(b1,3)+198*power(b1,2)*b2-...
2*b1*(86*power(b2,2)+...
3*power(e,2)*(-15*power(c,2)+17*power(W,2)))+...
b2*(34*power(b2,2)+3*power(e,2)*(5*power(c,2)+...
34*power(W,2))))+a*(2*power(b1,4)*b2+...
30*power(b1,2)*b2*power(e,2)*(5*power(c,2)+3*power(W,2))-...
2*power(b1,3)*(power(b2,2)+60*power(e,2)*power(W,2))+...
b2*power(e,2)*(power(c,2)*...
(23*power(b2,2)-420*power(e,2)*power(W,2))-...
14*power(W,2)*(power(b2,2)-18*power(e,2)*power(W,2)))+...
4*b1*power(e,2)*(11*power(b2,2)*power(W,2)-...
63*power(e,2)*power(W,4)+...
power(c,2)*(-38*power(b2,2)+21*power(e,2)*power(W,2))))-...
power(a,2)*e*(-26*power(b1,4)+95*power(b1,3)*b2+...
18*b1*b2*(power(b2,2)+...
power(e,2)*(17*power(c,2)+13*power(W,2)))-...
3*power(b1,2)*(29*power(b2,2)+...
power(e,2)*(-11*power(c,2)+85*power(W,2)))+...
power(e,2)*(48*power(c,4)*power(e,2)+21*power(b2,2)*power(W,2)-...
5*power(c,2)*(37*power(b2,2)+42*power(e,2)*power(W,2))))+...
e*(56*power(b2,2)*power(c,4)*power(e,2)+...
(b1-b2)*power(W,2)*(26*power(b1,3)-3*power(b1,2)*b2-...
b1*power(b2,2)+210*b1*power(e,2)*power(W,2)-...
84*b2*power(e,2)*power(W,2))+...
power(c,2)*(-132*power(b2,2)*power(e,2)*power(W,2)+...
power(b1,2)*(9*power(b2,2)-48*power(e,2)*power(W,2))-...
2*b1*(power(b2,3)-153*b2*power(e,2)*power(W,2))))),...
256*power(b1-b2,4)*power(b2,2)*power(e,8)*...
(28*power(b2,2)*power(c,4)*power(e,2)-...
15*power(a,5)*(b1-b2)*power(e,3)+...
3*power(a,4)*power(e,2)*(40*power(b1,2)-77*b1*b2+37*power(b2,2)-...
16*power(c,2)*power(e,2))+...
power(c,2)*(174*b1*b2*power(e,2)*power(W,2)-...
63*power(b2,2)*power(e,2)*power(W,2)+...
power(b1,2)*(power(b2,2)+15*power(e,2)*power(W,2)))+...
power(W,2)*(8*power(b1,4)-9*power(b1,3)*b2-...
156*b1*b2*power(e,2)*power(W,2)+...
36*power(b2,2)*power(e,2)*power(W,2)+...
power(b1,2)*(power(b2,2)+120*power(e,2)*power(W,2)))+...
a*e*(84*b2*power(c,4)*power(e,2)-...
(b1-b2)*power(W,2)*(78*power(b1,2)-6*b1*b2-power(b2,2)+...
210*power(e,2)*power(W,2))+...
power(c,2)*(70*power(b1,2)*b2-42*b1*power(b2,2)+3*power(b2,3)+...
48*b1*power(e,2)*power(W,2)-426*b2*power(e,2)*power(W,2)))+...
power(a,3)*e*(-78*power(b1,3)+168*power(b1,2)*b2+...
b1*(-100*power(b2,2)+...
9*power(e,2)*(2*power(c,2)-25*power(W,2)))+...
b2*(10*power(b2,2)+3*power(e,2)*(44*power(c,2)+...
75*power(W,2))))+power(a,2)*(8*power(b1,4)-17*power(b1,3)*b2-...
b1*b2*power(e,2)*(284*power(c,2)+261*power(W,2))+...
power(b1,2)*(9*power(b2,2)+...
5*power(e,2)*(11*power(c,2)+48*power(W,2)))+...
power(e,2)*(-84*power(c,4)*power(e,2)+21*power(b2,2)*power(W,2)+...
power(c,2)*(95*power(b2,2)+252*power(e,2)*power(W,2))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,7)*...
(8*power(b2,2)*power(c,4)*power(e,2)-...
40*power(a,5)*(b1-b2)*power(e,3)+...
power(a,4)*power(e,2)*(78*power(b1,2)-115*b1*b2+37*power(b2,2)+...
15*power(c,2)*power(e,2))+...
(40*power(b1,2)+61*b1*b2-17*power(b2,2))*power(c,2)*power(e,2)*...
power(W,2)+power(W,2)*...
(power(b1,4)-power(b1,3)*b2+...
45*power(b1,2)*power(e,2)*power(W,2)-...
54*b1*b2*power(e,2)*power(W,2)+9*power(b2,2)*power(e,2)*power(W,2))+...
power(a,3)*e*(-24*power(b1,3)+36*power(b1,2)*b2+...
b2*power(e,2)*(113*power(c,2)+160*power(W,2))-...
b1*(12*power(b2,2)+5*power(e,2)*(19*power(c,2)+...
32*power(W,2))))+a*e*(96*b2*power(c,4)*power(e,2)+...
power(c,2)*(18*power(b1,2)*b2-279*b2*power(e,2)*power(W,2)-...
5*b1*(power(b2,2)+3*power(e,2)*power(W,2)))-...
2*power(W,2)*(12*power(b1,3)-13*power(b1,2)*b2-...
60*b2*power(e,2)*power(W,2)+...
b1*(power(b2,2)+60*power(e,2)*power(W,2))))+...
power(a,2)*(power(b1,4)-power(b1,3)*b2+...
3*power(b1,2)*power(e,2)*(22*power(c,2)+41*power(W,2))-...
3*b1*b2*power(e,2)*(46*power(c,2)+45*power(W,2))+...
2*power(e,2)*(-24*power(c,4)*power(e,2)+...
6*power(b2,2)*power(W,2)+...
power(c,2)*(13*power(b2,2)+105*power(e,2)*power(W,2))))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,7)*...
(26*power(a,5)*(b1-b2)*power(e,2)-...
power(a,4)*e*(24*power(b1,2)-29*b1*b2+...
5*(power(b2,2)+8*power(c,2)*power(e,2)))-...
e*(power(b2,2)*power(c,4)+...
2*(13*power(b1,2)+6*b1*b2-power(b2,2))*power(c,2)*power(W,2)+...
(10*power(b1,2)-11*b1*b2+power(b2,2))*power(W,4))+...
power(a,3)*(3*power(b1,3)-3*power(b1,2)*b2-...
b2*power(e,2)*(49*power(c,2)+71*power(W,2))+...
b1*power(e,2)*(92*power(c,2)+71*power(W,2)))-...
power(a,2)*e*(15*power(c,4)*power(e,2)+...
2*(17*power(b1,2)-18*b1*b2+power(b2,2))*power(W,2)+...
power(c,2)*(34*power(b1,2)-36*b1*b2+3*power(b2,2)+...
120*power(e,2)*power(W,2)))+...
a*(-54*b2*power(c,4)*power(e,2)+...
3*(b1-b2)*power(W,2)*(power(b1,2)+15*power(e,2)*power(W,2))+...
power(c,2)*(-2*power(b1,2)*b2+40*b1*power(e,2)*power(W,2)+...
116*b2*power(e,2)*power(W,2)))),...
-256*power(b1-b2,4)*power(b2,2)*power(e,7)*...
(8*a*power(c,4)*e*(2*b2+5*a*e)+...
(b1-b2)*(power(a,2)+power(W,2))*...
(3*power(a,2)*b1-8*power(a,3)*e+b1*power(W,2)-10*a*e*power(W,2))...
+power(c,2)*(26*power(a,4)*power(e,2)+...
power(a,3)*(-42*b1*e+11*b2*e)+b1*(8*b1+b2)*power(W,2)-...
2*a*(13*b1+14*b2)*e*power(W,2)+...
power(a,2)*(9*power(b1,2)-4*b1*b2+45*power(e,2)*power(W,2)))),...
256*power(b1-b2,4)*power(b2,2)*power(e,6)*...
(2*a*power(c,4)*e*(b2+13*a*e)-...
a*(b1-b2)*e*power(power(a,2)+power(W,2),2)+...
power(c,2)*(power(a,3)*(-10*b1+b2)*e+8*power(a,4)*power(e,2)+...
power(b1,2)*power(W,2)-a*(8*b1+3*b2)*e*power(W,2)+...
power(a,2)*(power(b1,2)+10*power(e,2)*power(W,2)))),...
-256*a*power(b1-b2,4)*power(b2,2)*power(c,2)*power(e,6)*...
(-(power(a,2)*b1)+power(a,3)*e-b1*power(W,2)+...
a*e*(8*power(c,2)+power(W,2))),...
256*power(a,2)*power(b1-b2,4)*power(b2,2)*power(c,4)*power(e,6)]);

%% Calculate Jacobian matrix
function J = JacobianCoupled11(a, b1, b2, e, c, r1, r2, psi)
J = zeros(3);
J(1,1) = a + 3*b1*r1^2 + e*b2*r1^4*(5-3*e*r1^2)/(1-e*r1^2)^2;
J(1,2) = c*cos(psi);
J(1,3) = -c*r2*sin(psi);
J(2,1) = c*cos(psi);
J(2,2) = a + 3*b1*r2^2 + e*b2*r2^4*(5-3*e*r2^2)/(1-e*r2^2)^2;
J(2,3) = -c*r1*sin(psi);
J(3,1) = c*(r2^2 - r1^2)/(r1^2*r2)*sin(psi);
J(3,2) = c*(r1^2 - r2^2)/(r1*r2^2)*sin(psi);
J(3,3) = -c*(r1^2 + r2^2)/(r1*r2)*cos(psi);